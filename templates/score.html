<#include "assets/base.html">
<div class="container mb-4">
    <!-- Main Score Card with Hero Section -->
    <div class="card rounded">
        <!-- Hero Section with Score Header -->
        <div class="bg-gradient rounded position-relative"
             style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="row p-4 position-relative">
                <!-- Grade Display -->
                <div class="col-12 col-md-3 d-flex justify-content-center align-items-center mb-3 mb-md-0">
                    <div class="position-relative">
                        <div class="osu-score-hero-grade">
                            <#assign height=120>
                            <#include "/freemarker/gradeconvert.ftl">
                        </div>
                    </div>
                </div>
                
                <!-- Score Title and Info -->
                <div class="col-12 col-md-9 d-flex flex-column justify-content-center text-white">
                    <div class="mb-2">
                        <h1 class="display-4 fw-bold mb-2 shiina-player-name <#if score.supporter>supporter</#if>">
                            ${score.username}'s Score
                        </h1>
                        <div class="d-flex flex-wrap gap-3 mt-2 mb-2">
                            <div class="d-flex align-items-center bg-dark bg-opacity-20 rounded px-3 py-2">
                                <i class="fas fa-calendar me-2"></i>
                                <span class="fw-medium" data-timestamp-format="date" data-timestamp="${score.playTime}">
                                    ${score.playTime}
                                </span>
                            </div>
                            <#if score.mods?size != 0>
                            <div class="d-flex align-items-center bg-warning bg-opacity-20 rounded px-3 py-2">
                                <span class="fw-medium">
                                    <#assign passedMods=score.mods>
                                    <#include "/freemarker/modconvert.ftl">
                                </span>
                            </div>
                            </#if>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 flex-wrap">
                        <a download href="${apiUrlPub}/v1/get_replay?id=${score.id?c}" class="btn btn-outline-secondary-download">
                            <i class="fa-solid fa-download me-2"></i>Download Replay
                        </a>
                        <!-- TODO: Reports 
                        <#if user??>
                        <button type="button" class="btn btn-outline-light btn-lg">
                            <i class="fa-solid fa-exclamation-triangle me-2"></i>Report Score
                        </button>
                        </#if> -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="card-body bg-body">
            <div class="row g-4 mb-4">
                <!-- Performance Stats -->
                <div class="col-md-3 col-6">
                    <div class="text-center p-3 bg-primary bg-opacity-10 rounded border border-primary border-opacity-25">
                        <div class="h2 fw-bold text-primary mb-1">${score.pp?string("0")}<small class="fs-6 text-muted">pp</small></div>
                        <div class="text small">Performance Points</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center p-3 bg-success-accuracy bg-opacity-10 rounded border border-success border-opacity-25">
                        <div class="h2 fw-bold text-success mb-1">${score.acc?string("0.00")}<small class="fs-6 text-muted">%</small></div>
                        <div class="text small">Accuracy</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center p-3 bg-info bg-opacity-10 rounded border border-info border-opacity-25">
                        <div class="h2 fw-bold text-info mb-1">${score.score}</div>
                        <div class="text small">Score</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="text-center p-3 bg-warning bg-opacity-10 rounded border border-warning border-opacity-25">
                        <div class="h2 fw-bold text-warning mb-1">${score.maxCombo}<small class="fs-6 text-muted">x</small></div>
                        <div class="text small">Max Combo</div>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="row g-2">
                <!-- Beatmap Information -->
                <div class="col-lg-6 h-100">
                    <#assign beatmap=score.beatmap>
                    <#assign bigBm=true>
                    <#include "/freemarker/models/beatmap.ftl">
                </div>

                <!-- Hit Statistics -->
                <div class="col-lg-6">
                    <div style="background: rgba(0,0,0,0.1);" class="card h-100">
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="text-center p-2 bg-info bg-opacity-10 rounded border border-info border-opacity-25">
                                        <div class="fw-bold text-info">${score.n300}</div>
                                        <div class="small text-muted">300s</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-2 bg-info bg-opacity-10 rounded border border-info border-opacity-25">
                                        <div class="fw-bold text-info">${score.ngeki}</div>
                                        <div class="small text-muted">Gekis</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-2 bg-warning-300 bg-opacity-10 rounded border border-warning border-opacity-25">
                                        <div class="fw-bold text-warning-300">${score.n100}</div>
                                        <div class="small text-muted">100s</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-2 bg-warning-300 bg-opacity-10 rounded border border-warning border-opacity-25">
                                        <div class="fw-bold text-warning-300">${score.nkatu}</div>
                                        <div class="small text-muted">Katus</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-2 bg-warning bg-opacity-10 rounded border border-warning border-opacity-25">
                                        <div class="fw-bold text-warning">${score.n50}</div>
                                        <div class="small text-muted">50s</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-2 bg-danger bg-opacity-10 rounded border border-danger border-opacity-25">
                                        <div class="fw-bold text-danger">${score.nmiss}</div>
                                        <div class="small text-muted">Misses</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Information Row -->
            <div class="row g-2 mt-2">
                <!-- Play Information -->
                <div class="col-md-6">
                    <div style="background: rgba(0,0,0,0.1);" class="card h-100">
                        <div class="card-body">
                            <div class="d-flex flex-column gap-3">
                                <div class="d-flex justify-content-between align-items-center p-2 bg-light bg-opacity-10 rounded">
                                    <span class="fw-medium">Play Time:</span>
                                    <span>${score.playTime}</span>
                                </div>
                                <#if score.status??>
                                <div class="d-flex justify-content-between align-items-center p-2 bg-light bg-opacity-10 rounded">
                                    <span class="fw-medium">Status:</span>
                                    <span>${convertScoreStatus(score.status)}</span>
                                </div>
                                </#if>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Player Profile Link -->
                <div class="col-md-6">
                    <div style="background: rgba(0,0,0,0.1);" class="card border-0 h-100">
                        <div class="card-body p-0">
                            <a href="/u/${score.userId?c}?mode=${score.mode}" class="d-block border rounded text-decoration-none">
                                <div class="d-flex align-items-center p-3 h-100 text-decoration-none text-white hover-bg-light">
                                    <div class="me-3">
                                        <img src="${avatarServer}/${score.userId?c}" alt="${score.username}" 
                                             class="rounded" width="48" height="48">
                                    </div>
                          
                                      <!-- Country Flag (hidden on small screens) -->
                                    <div class="me-3 d-none d-md-block">
                                        <img src="/img/flags/${score.country}.svg" 
                                             alt="${score.country}" 
                                             class="rounded" 
                                             width="24" height="18">
                                    </div>
                                    
                                    <div class="flex-grow-1">
                                        <div class="fw-bold <#if score.supporter>supporter</#if>">${score.username}</div>
                                        <div class="text-muted small">Played <span data-timestamp-format="date" data-timestamp="${score.playTime}">${score.playTime}</span></div>
                                    </div>
                                    <div class="text-white">
                                        <i class="fa fa-arrow-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<#include "assets/footer.html">